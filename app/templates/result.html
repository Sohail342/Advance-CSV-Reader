{% extends "base.html" %}

{% block content %}
<style>
    /* Bigger stat cards */
    .stat-card {
        max-width: 250px;   /* increased from 200px */
        margin: 0 auto;
        padding: 1rem 0.5rem;
    }

    /* Bigger icons */
    .stat-icon {
        width: 55px;       /* increased from 35px */
        height: 55px;
        font-size: 1.2rem; /* larger icon size */
    }

    /* Bigger numbers inside cards */
    .stat-card h6 {
        font-size: 1.5rem;  /* larger count number */
    }

    /* Keep buttons small */
    .download-btn {
        max-width: 220px;
        margin: 0 auto;
        font-size: 0.85rem;
        padding: 0.4rem 0.75rem;
    }

    .action-btn {
        max-width: 200px;
        margin: 0 auto;
        font-size: 0.85rem;
        padding: 0.5rem 0.75rem;
    }
</style>

<div class="container py-4">
    <!-- Header -->
    <div class="text-center mb-4">
        <i class="fas fa-check-circle text-success fa-2x mb-2"></i>
        <h5 class="fw-bold mb-1">Processing Complete</h5>
        <p class="text-muted small">Your data has been successfully processed and synchronized with the database.</p>
    </div>

    <!-- Stats Section -->
    <div class="row g-3 justify-content-center mb-4">
        <div class="col-6 col-sm-4 col-md-2">
            <div class="card shadow-sm stat-card text-center">
                <div class="card-body p-2">
                    <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center mx-auto mb-2 stat-icon">
                        <i class="fas fa-table"></i>
                    </div>
                    <h6 class="fw-bold text-primary mb-0">{{ result.total_rows }}</h6>
                    <small class="text-muted">Rows</small>
                </div>
            </div>
        </div>

        {% if operation_type == 'comparison' %}
        <div class="col-6 col-sm-4 col-md-2">
            <div class="card shadow-sm stat-card text-center">
                <div class="card-body p-2">
                    <div class="rounded-circle bg-success text-white d-flex align-items-center justify-content-center mx-auto mb-2 stat-icon">
                        <i class="fas fa-edit"></i>
                    </div>
                    <h6 class="fw-bold text-success mb-0">{{ result.updated_records }}</h6>
                    <small class="text-muted">Updated</small>
                </div>
            </div>
        </div>
        <div class="col-6 col-sm-4 col-md-2">
            <div class="card shadow-sm stat-card text-center">
                <div class="card-body p-2">
                    <div class="rounded-circle bg-info text-white d-flex align-items-center justify-content-center mx-auto mb-2 stat-icon">
                        <i class="fas fa-plus-circle"></i>
                    </div>
                    <h6 class="fw-bold text-info mb-0">{{ result.inserted_records }}</h6>
                    <small class="text-muted">Inserted</small>
                </div>
            </div>
        </div>
        {% else %}
        <div class="col-6 col-sm-4 col-md-2">
            <div class="card shadow-sm stat-card text-center">
                <div class="card-body p-2">
                    <div class="rounded-circle bg-success text-white d-flex align-items-center justify-content-center mx-auto mb-2 stat-icon">
                        <i class="fas fa-link"></i>
                    </div>
                    <h6 class="fw-bold text-success mb-0">{{ result.matched_records }}</h6>
                    <small class="text-muted">Matched</small>
                </div>
            </div>
        </div>
        <div class="col-6 col-sm-4 col-md-2">
            <div class="card shadow-sm stat-card text-center">
                <div class="card-body p-2">
                    <div class="rounded-circle bg-info text-white d-flex align-items-center justify-content-center mx-auto mb-2 stat-icon">
                        <i class="fas fa-plus-circle"></i>
                    </div>
                    <h6 class="fw-bold text-info mb-0">{{ result.new_records }}</h6>
                    <small class="text-muted">New</small>
                </div>
            </div>
        </div>
        <div class="col-6 col-sm-4 col-md-2">
            <div class="card shadow-sm stat-card text-center">
                <div class="card-body p-2">
                    <div class="rounded-circle bg-success text-white d-flex align-items-center justify-content-center mx-auto mb-2 stat-icon">
                        <i class="fas fa-link"></i>
                    </div>
                    <h6 class="fw-bold text-success mb-0">{{ result.out_of_scop }}</h6>
                    <small class="text-muted">Out of Scope</small>
                </div>
            </div>
        </div>
        {% endif %}

        <div class="col-6 col-sm-4 col-md-2">
            <div class="card shadow-sm stat-card text-center">
                <div class="card-body p-2">
                    <div class="rounded-circle bg-danger text-white d-flex align-items-center justify-content-center mx-auto mb-2 stat-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <h6 class="fw-bold text-danger mb-0">{{ result.error_records }}</h6>
                    <small class="text-muted">Errors</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Error List -->
    {% if result.errors %}
    <div class="card shadow-sm border-warning mb-3">
        <div class="card-header bg-warning text-dark small fw-bold py-2">
            <i class="fas fa-exclamation-triangle me-1"></i> Issues
        </div>
        <div class="card-body p-2">
            <ul class="list-unstyled mb-0 small">
                {% for error in result.errors %}
                <li class="mb-1"><i class="fas fa-dot-circle text-warning me-1"></i>{{ error }}</li>
                {% endfor %}
            </ul>
        </div>
    </div>
    {% endif %}

    <!-- Downloads -->
    <div class="card shadow-sm mb-4">
        <div class="card-header bg-light small fw-bold py-2">
            <i class="fas fa-download me-1"></i> Downloads
        </div>
        <div class="card-body p-3">
            {% if csv_id %}
            <div class="row g-2 justify-content-center">
                {% if operation_type == 'comparison' %}
                <div class="col-6 col-md-3">
                    <a href="/csv/download/{{ csv_id }}/updated" class="btn btn-success btn-sm download-btn w-100 shadow-sm">
                        <i class="fas fa-download me-1"></i> Updated
                    </a>
                </div>
                <div class="col-6 col-md-3">
                    <a href="/csv/download/{{ csv_id }}/inserted" class="btn btn-info btn-sm download-btn w-100 shadow-sm">
                        <i class="fas fa-download me-1"></i> Inserted
                    </a>
                </div>
                {% else %}
                <div class="col-6 col-md-3">
                    <a href="/csv/download/{{ csv_id }}/matched" class="btn btn-success btn-sm download-btn w-100 shadow-sm">
                        <i class="fas fa-download me-1"></i> Matched
                    </a>
                </div>
                <div class="col-6 col-md-3">
                    <a href="/csv/download/{{ csv_id }}/matched_ready_to_upload" class="btn btn-success btn-sm download-btn w-100 shadow-sm">
                        <i class="fas fa-download me-1"></i> Matched (Upload Ready Format)
                    </a>
                </div>
                <div class="col-6 col-md-3">
                    <a href="/csv/download/{{ csv_id }}/new" class="btn btn-info btn-sm download-btn w-100 shadow-sm">
                        <i class="fas fa-download me-1"></i> New
                    </a>
                </div>
                <div class="col-6 col-md-3">
                    <a href="/csv/download/{{ csv_id }}/out_of_scop_glcodes_path" class="btn btn-info btn-sm download-btn w-100 shadow-sm">
                        <i class="fas fa-download me-1"></i> Out of Scope (SubGlCode are found)
                    </a>
                </div>
                {% endif %}
            </div>
            {% else %}
            <div class="text-center small text-muted py-2">
                <i class="fas fa-info-circle me-1"></i> No downloads available
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="row g-2 justify-content-center">
        <div class="col-6 col-md-3">
            <a href="/csv/upload" class="btn btn-primary btn-sm action-btn w-100 shadow-sm">
                <i class="fas fa-plus me-1"></i> Process File
            </a>
        </div>
        <div class="col-6 col-md-3">
            <a href="/" class="btn btn-outline-secondary btn-sm action-btn w-100 shadow-sm">
                <i class="fas fa-home me-1"></i> Home
            </a>
        </div>
    </div>
</div>
{% endblock %}